import React, { forwardRef, useLayoutEffect, useRef } from "react";
import tailwindConfig from "../../tailwind.config.js";
import { Link } from "./Partials/Link.jsx";
import { Container } from "./Partials/Container.jsx";
import { Article } from "./Partials/Article.jsx";
import Animation from "../Classes/Animation.js";

export const WorkMap = forwardRef(({ contact }, ref) => {
  const defaultColors = tailwindConfig.theme.extend.colors;

  const props = {
    pointFill: defaultColors["dark-blue"],
    pointRadius: "5",
    pointStrokeColor: defaultColors["dark-orange"],
    regionFill: defaultColors["dark-blue"],
    regionStrokeColor: defaultColors["dark-orange"],
    regionStrokeWidth: "2.5",
  };

  const callRef = useRef(null);
  const mapRef = useRef(null);

  useLayoutEffect(() => {
    const observer = new IntersectionObserver((entries) => {
      const entry = entries[0];

      if (entry.isIntersecting) {
        const animation = new Animation([callRef.current, mapRef.current]);
        animation.animateAll("", "-.2");
      }
    });

    observer.observe(mapRef.current);
  }, []);
  const map = {
    regions: [
      {
        name: "sl",
        d: "M122.519 418.622l-1.374-.185-.457.185-.365.641-7.147 7.989-.641.55-1.19.459-.826.182h-2.565l-1.649.275-1.374.736-1.191 1.102-1.098 1.838-1.377 4.129.186.185.272.366.185.643-.275.826-.368.275-1.006.093h-.185l-.641 2.478-.181 1.652-.641 1.01-2.565 1.009-2.017.462-.916-.093-.733-.459-1.65-1.193-.826-.276-1.831.458-3.204 1.93-2.107.09-1.559-.276-.459-1.469.276-4.222-.183-1.837-.367-1.742-.091-1.837.734-2.202-2.476-1.469-8.244-.738.368-1.926v-.183l-.186-2.663-1.191-5.509-.366-1.102-1.007-2.295-.366-1.194-.55-4.497-.365-1.012-1.285-.916-1.283.276-1.281.55-1.191.09-1.099-.64-1.649-1.931-1.008-.919-1.192-.364h-.826l-1.19-.186h-.548l-1.102-.826-.547-.919-.826-3.761-2.014-4.04-1.374-3.95-.092-3.396.458-.459v-.092l1.098-1.284.458-.461.092-.182v-.368l-2.014-1.009-.367-1.655.275-1.926-.551-2.385-1.28-.736-.826.55-1.281.826-1.102.736h-1.924l-6.227-3.397-3.209-1.193-1.921.274v.459h-.919v.093l-.183.274-.275.183-.272.276-.462.367-1.097 1.009-1.191.186-1.649-1.376-.458-.826-.642-2.021-.274-.736-1.009-.733-1.924-.368-1.006-.458-2.657-2.295-1.283-.644-5.223-1.01-1.099-1.285.551-2.388-3.573-2.295-.733-.458-.551-.461-1.191-.275.093-1.559v-.643l4.947-9.732 10.444-2.202 5.037-3.765 8.061-3.764.826-3.765.091-6.704-1.374-16.706.733-2.756 1.833-.275 1.833-.919.09-2.296-.916-2.385 1.102-2.938 2.471-.55 12.095.089-1.009-4.681-2.657-2.845-2.656-2.113-2.2-3.028-1.648-4.959 2.014-5.416 1.467-8.262 2.199-4.684 6.504-4.221.643-4.684-1.102-2.388-.548-3.028.641-2.021 1.009-1.286 2.84-10.097 4.213-2.112 11.726-.369 2.747-1.283 2.568-1.838 2.929.551 2.565 2.663 10.903 5.875 5.404 1.104h6.596l2.84-2.48 5.591 1.011 5.037 4.59 7.787 12.485 2.749.826 8.335-.459 9.071 4.592 7.054 1.376 1.099.643.274 1.469v1.559l-.365 1.102-5.679.918-3.116 5.968 2.29 2.662 6.23 1.838 2.84 2.202 2.382 5.141 3.939 4.866-3.389.552-5.679 4.775-1.65 3.671 2.841 1.559 5.68.826 2.379.919.551 2.847.182 2.295-10.534 6.61-2.565.46-4.671-.367-4.582.733-7.33 5.694-2.106.458-2.2.092-4.578-2.662-2.2 3.303-2.382 4.684-3.573 5.141-5.587-.826-2.566 2.112 4.397 4.406 3.849 5.416-19.698 22.219-1.831 2.663-1.833 3.855-.916 4.315 1.649 2.205 2.197.183 1.835 2.295.182 4.315 2.473 4.497 4.213 1.652 1.65 3.032 1.283 4.04 2.657 2.478 3.116 1.469 5.68 1.012-.275 3.304-1.466 2.938-.642 2.663 1.006 2.295 1.924 1.376.459 1.47h.915z",
      },
      {
        name: "sw",
        d: "M164.969 303.95l-2.388-.919-5.691-.826-2.846-1.559 1.651-3.671 5.692-4.775 3.396-.552-3.946-4.866-2.388-5.141-2.845-2.202-6.244-1.838-2.295-2.662 3.121-5.968 5.692-.918.369-1.102v-1.559l-.276-1.469-1.102-.643-7.07-1.376 1.93-3.215 2.385-2.295 2.938-1.927 1.376-3.947-.364-4.132.09-4.223 1.1-4.315 2.94-.551 11.018 8.077 1.834-2.203.643-4.314-.733-4.406-2.57-2.112-3.858-5.785 2.114-7.987 2.019-2.663 2.57-1.009 9.272 1.284 2.662-.733 5.784-5.509 2.664-1.287 2.754-.458 2.756-1.283 3.028-7.529 2.388-1.838 4.59 1.652 2.478 6.335 13.771 8.448 1.928 2.202 1.744 2.756 2.112 1.652 10.1 2.109 11.567-1.833 2.756-1.563 2.478-3.488 2.569-2.478 2.571.918.644 4.407 2.477 2.847.368 2.202.551 2.02 5.691 3.764 6.429.551 13.771 4.315 26.624-5.601.368 1.837-.368.733-.643.551-.734.368-.55.093v.919l1.469 1.193.276 2.571-.552 5.691-.092.458-.275.183-.183.461-.093.826.183.733.368.367.368.186.183.459.182 1.283 2.113 8.08.457 2.846.186 1.744.183 4.865-.733 5.234-.55 2.021-1.012 2.388-1.285 1.926-1.469.826-2.204.369-1.467 1.009-2.389 4.039-3.947 4.683-.55 2.021-.461 2.57-1.008 2.019-2.571 3.121-1.561 1.288-5.325 1.376-7.989 3.58.368.55.825 2.112-1.558 1.652-2.206 1.287-2.109.458-1.562-.734-5.049 4.499-.368.093-1.193-.093-.276.274v.552l.093.643-.093.367-.919.735-.55-.093-.733-.642-.459 1.835-1.012.919-1.007.457-.369.737-.185 1.101-.275.275h-.459l-.55.458-1.469 2.02v.186l-1.47.365-.825-.734-.733-.918-1.195-.551-.825.186-3.49 1.652-.736.733-.826.826-.919.826-1.283.367-6.153.186-.826.276-.733.64-.826 1.102-.736.46-2.295.183-1.194.736-1.284-.826-1.102.733-1.1 1.194-1.38.643-3.211-3.032-.46.737-.552 2.295-1.745 1.745-.274.182h-.733l-.369.276-.274.643-.093 1.377-.276.643-1.194 1.191-2.66 1.287-1.011 1.652-.369 1.376-2.478 2.664-10.924-.369-6.151-3.671-1.562-3.304-3.764-5.327-1.47-3.028-1.376-6.06-3.854-7.528-6.335-4.316-7.072-2.202-2.752-2.939-3.307-1.745h-7.802z",
      },
      {
        name: "ml",
        d: "M122.644 418.622l-.459-1.47-1.929-1.376-1.008-2.295.643-2.663 1.468-2.938.276-3.304-5.694-1.012-3.121-1.469-2.661-2.478-1.286-4.04-1.652-3.032-4.223-1.652-2.48-4.497-.183-4.315-1.838-2.295-2.202-.183-1.652-2.205.916-4.315 1.838-3.855 1.836-2.663 19.739-22.219-3.857-5.416-4.406-4.406 2.571-2.112 5.599.826 3.582-5.141 2.385-4.684 2.205-3.303 4.591 2.662 2.203-.092 2.113-.458 7.343-5.694 4.59-.733 4.683.367 2.571-.46 10.557-6.61-.181-2.295-.552-2.847h7.802l3.307 1.745 2.752 2.939 7.072 2.202 6.335 4.316 3.854 7.528 1.376 6.06 1.47 3.028 3.764 5.327 1.562 3.304 6.151 3.671 10.924.369 2.478-2.664.369-1.376 1.011-1.652 2.66-1.287 1.194-1.191.276-.643.093-1.377.274-.643.369-.276h.733l.274-.182 1.745-1.745.552-2.295.46-.737 3.211 3.032 1.38-.643 1.1-1.194 1.102-.733 1.284.826 1.194-.736 2.295-.183.736-.46.826-1.102.733-.64.826-.276 6.153-.186 1.283-.367.919-.826.826-.826.736-.733 3.49-1.652.825-.186 1.195.551.733.918.825.734 1.47-.365v-.186l1.469-2.02.55-.458h.459l.275-.275.185-1.101.369-.737 1.007-.457 1.012-.919.459-1.835.733.642.55.093.919-.735.093-.367-.093-.643v-.552l.276-.274 1.193.093-.919 10.924-2.478 6.243-3.121 5.324-.55 7.346 2.295 19.555-.736 5.782-.09 4.959.826 1.561.643 1.745 1.742 2.111 2.388.184 3.121 1.652 1.101 3.765-8.262 6.335-1.469 3.211 2.481 2.295 8.995 3.858 4.959 5.416 2.938 8.998.275 4.499-.461 4.497 1.47 9.367 3.031 8.536.09.276v.093l-1.466.64-1.287-.364-3.029.64h-1.378l-8.17-2.296-4.684-2.478-1.1-.275-1.471 1.012-2.662 3.854-1.377 1.376-1.834.276-1.287-.826-1.194-1.376-1.47-1.009-1.283-.093-3.397.643-1.286.641-1.652 1.837 1.008 1.195 1.93 1.193 1.009 1.928-.733 1.193-1.469.276h-1.838l-1.284.275-1.651 1.652-2.756 4.04-1.835 1.562-1.931.733-1.559-.276-1.286-1.007-1.376-1.471-1.563-1.103-1.284-.183h-1.469l-1.837-.275-1.376-.919-7.344-8.906-1.287-.183-3.214.459-1.742-.276-.829.093-.826.458-1.283 1.655-1.012.915-1.927.737-1.837-.461-7.069-3.672-1.283.368v2.202l-4.316.093-3.399-1.286-1.008.093-.826.643-.275.733-.186 1.195-.457 1.836-.552 1.745-.457.551-6.428.643-1.287.64-1.741 2.205-.83.733-1.833-.181-.276-.186-.461.643-1.558 3.583-.462 1.469-.55 1.466-1.102 1.194-.457 4.5-.826 3.211-1.655 1.195-2.753-1.285-4.316-4.132-2.295-1.194-2.663.368-1.559 1.101-1.562 1.652-1.195 1.195-1.833.736-3.858-.276-2.11-.829-1.104-1.466.368-1.655 3.121-5.141.369-.365.55-.093.458-.275.275-.736-.183-.55v-.09l-.643-.643h-.09l-.093-.369-1.193-.826-.276-.457.093-.462.643-1.009.09-.55-.457-6.153-.461-2.112-.734-2.385v-.093l-.826-.55-2.756 1.1-1.652.186-1.833-.186-4.776-1.652.184-1.469-.091-2.019.181-.733.369-.826h-3.304l-1.745-.461-1.469-1.101-.461-.919-1.283-4.129-1.562-6.429-1.009-2.57-1.93-1.287-.641-.733-1.376-2.478-.736-.275z",
      },
      {
        name: "pd",
        d: "M294.693 442.125v-.093l-.09-.276-3.031-8.536-1.47-9.367.461-4.497-.275-4.499-2.938-8.998-4.959-5.416-8.995-3.858-2.481-2.295 1.469-3.211 8.262-6.335-1.101-3.765-3.121-1.652-2.388-.184-1.742-2.111-.643-1.745-.826-1.561.09-4.959.736-5.782-2.295-19.555.55-7.346 3.121-5.324 2.478-6.243.919-10.924.368-.093 5.049-4.499 1.562.734 2.109-.458 2.206-1.287 1.558-1.652-.825-2.112-.368-.55 7.989-3.58 5.325-1.376 1.561-1.288 2.571-3.121 1.008-2.019.461-2.57.55-2.021 3.947-4.683 2.389-4.039 1.467-1.009 2.204-.369 1.469-.826 1.285-1.926 1.012-2.388.55-2.021.733-5.234-.183-4.865-.186-1.744 10.926 7.435 6.246.369 5.506-3.854 3.307-.186 3.214 1.195 2.935 1.836 2.663 2.385-1.194 3.306-3.764 7.162 1.562 2.753 19.37 4.958 13.13 7.069.826 1.194-.092 1.744.185 1.838 1.928 3.671 1.009 3.214-2.296 1.285-2.57-.276-2.661.826-2.02 2.756-1.379 2.753.55 3.215 2.206 3.302 2.938 1.38 11.566-2.295 2.205 1.559-1.286.736-2.846.733.826 1.927 11.383 3.215 18.731.643 6.335-1.376 5.416-4.316 6.793-7.805 2.205-1.011 4.773-.458 6.153.733 5.231 3.307 2.662 4.04 8.356 4.958h.092l-.092.183v.093l-.183.09-.643.186-.551.274h-.185l-.09.459-.186.55-.182.55-.092.093-.09.369v.09h-.093l-.55.274-.369.093-.276.183-.274.093h-.093l-.183.367-.183.276-.093.183-.093.185-.088.089-.093.186-.369.733-.183.183-.091.186-.552.918-.09.091-1.286 1.469-.183.092-.919.551v.092l-.274.183-.186.182-.366.186-.185.183-.733.55-.551.368v.093h-.092l-.093.09-.09.093-.275.182-.185.185-.091.091-.367.368h-.093l-.183.182-.275.275-.275.186-.093.09h-.09l-.368.186-.275.181-.461.276h-.09l-.186.186-.274.09-.641.367-.368.183-.093.093h-.093l-.457.55-.826 1.102-.276.274-.093.186-.274.366-.919.736-2.571 2.845-.276.093-.457.366-.183.185-.461.365-.551.368-.183.182-.091.093-.183.183v.093l-.643.55-.183.185-.093.183-.185.183-.183.275-.182.185-.552.552-.274.182-.186.275-.09.093-.368.369-.275.364-.368.369-.369.457-.181.276-.369.367-.183.186-.274.365-.093.185-.183.183-.46.093v.09l-.366.186-.46.274-.09.183-.093.369-.093.092-.64.275-.093.09h-.276l-.274-.183-.093.093.093.276v1.466l-.186.093-.276.276-.364.274-.276.276-.186.093-.183.274-.274.369-.276.457-.186.369-.274.368-.276.458-.183.183-.733.825-.185.093-.551.275-.643.276-.275.092-.091.733v.461l-.55.551-2.48 3.947-3.121 2.388-3.304 3.672-8.998 13.22-3.49 3.672-.457 1.012-.645 2.571-.274.64-.183.093-.276.367-.367.459-.093.181-1.377.462-.734.55-.828.919-5.14 9.364-.276.274-.09.093h-.093l-.55.093-.55.09h-.186l-.09.093-.736 1.009-.183.274-1.376.276-.919.829-.552 1.101-1.468 4.04-6.335 8.537-2.021 4.773h-.092v.093l.092.092.093.183.09.183.093.368v.092l.093.276.183.55v.183l.093.276.181.55.093.093.644 1.838.551 1.926.55 5.417.276 1.469.183.733 1.1 1.655 1.838 1.928.457 1.007.369 2.021 1.101 11.662-.276 1.926-.918 2.389-.183.089-.182.276-.185.461v.274l-.091.366-.092.46.092.093-1.011 3.947-1.376 2.754-.459 1.562.551.643.365-.186 1.104-1.469 1.284 1.012h-.093l-.274.09 2.663 1.93 2.477 3.214 1.563 1.1 3.671 2.111 1.011 1.286v1.102l-.735 2.478-.091 1.744.365 1.194 1.378 2.295.092.275.093.462-.461.915-.458 1.104-1.652-.736-1.93-1.652-1.466-.826-.919-.276-1.562-2.204-.733-.641-.093-.093-.55-.092-.276-.091h-.093v.091l-1.834.55-2.664-.275h-.367l-1.009.092-.736.093-1.835-.185-2.019-1.47-3.121-3.397-1.287-.457-.369-.093-1.741 1.652-2.939-1.376-6.52-.276-3.028-.919-4.223-4.315-1.745-.64-4.683.183-3.854-1.287-.644-.458-.184-.826.277-.826-.093-.919-.917-1.008-.645-.092-2.019.181h-.826l-.919-.457-2.753-1.745-5.878-1.1-2.385-1.745-.55-4.04-1.012-4.498-2.385-3.95-3.031-2.846-4.498-2.202-3.031-2.846-1.559-.826-1.652.275-1.469 1.285-1.194 1.469-.826.55-1.286-1.009-2.847-4.314-1.376-1.471-.826-.274-1.287.274h-.641l-.828-.643-1.559-1.469-.826-.64-1.562-.369-5.968.645-1.286.55z",
      },
    ],
    points: [
      { cx: "265.212", cy: "410.853", region: "ml" },
      { cx: "162.917", cy: "359.276", region: "ml" },
      { cx: "251.055", cy: "365.125", region: "ml" },
      { cx: "226.891", cy: "415.993", region: "ml" },
      { cx: "170.073", cy: "434.346", region: "ml" },
      { cx: "202.899", cy: "403.503", region: "ml" },
      { cx: "247.134", cy: "404.798", region: "ml" },
      { cx: "219.148", cy: "371.21", region: "ml" },
      { cx: "352.265", cy: "423.848", region: "pd" },
      { cx: "399.5", cy: "395.018", region: "pd" },
      { cx: "315.361", cy: "406.48", region: "pd" },
      { cx: "335.944", cy: "361.893", region: "pd" },
      { cx: "308.626", cy: "291.712", region: "pd" },
      { cx: "291.368", cy: "399.906", region: "pd" },
      { cx: "286.376", cy: "362.406", region: "pd" },
      { cx: "339.117", cy: "290.272", region: "pd" },
    ],
  };

  return (
    <Container
      ref={ref}
      className={"relative lg:h-screen bg-dark-blue flex justify-center"}
    >
      <Article
        title={"Gdzie wykonujemy studnie głebinowe?"}
        darkTheme={true}
        header={
          <>
            Nasze usługi wiercenia studni głębinowych świadczymy na terenie
            całego{" "}
            <span className={"text-dark-orange underline"}>
              województwa małopolskiego
            </span>{" "}
            i{" "}
            <span className={"text-dark-orange underline"}>podkarpackiego</span>
            .
          </>
        }
      >
        <div
          className={
            "flex lg:flex-row flex-col gap-x-[10%] items-center justify-center self-end lg:mt-20 mt-10"
          }
        >
          <svg
            ref={mapRef}
            xmlns="http://www.w3.org/2000/svg"
            overflow="hidden"
            viewBox="0 191.491 477.643 308.509"
            style={{
              position: "relative",
            }}
            className={
              "lg:w-[110%] md:w-[60%] sm:w-[80%] w-full -translate-x-64 opacity-0 "
            }
          >
            {map.regions.map((region, index) => (
              <path
                key={index}
                fill={props.regionFill}
                stroke={
                  region.name === "ml" || region.name === "pd"
                    ? props.regionStrokeColor
                    : "#ffffff"
                }
                strokeLinejoin="round"
                strokeWidth={
                  region.name === "ml" || region.name === "pd"
                    ? props.regionStrokeWidth
                    : props.regionStrokeWidth / 1.5
                }
                d={region.d}
                cursor="pointer"
                className={
                  "ml" === region.name
                    ? `hover:scale-[1.025] hover:fill-light-orange hover:-translate-x-[5px] hover:-translate-y-[10px] data-[region=ml]:[&~circle]:hover:fill-dark-orange data-[region=ml]:[&~circle]:hover:stroke-dark-blue transition duration-500 hover:stroke-dark-orange`
                    : "" + "pd" === region.name
                      ? `hover:scale-[1.025] hover:fill-light-orange hover:-translate-x-[5px] hover:-translate-y-[10px] data-[region=pd]:[&~circle]:hover:fill-dark-orange data-[region=pd]:[&~circle]:hover:stroke-dark-blue transition duration-500`
                      : ""
                }
              ></path>
            ))}
            {map.points.map((point, index) => (
              <circle
                key={index}
                cx={point.cx}
                cy={point.cy}
                r={props.pointRadius}
                fill={props.pointFill}
                stroke={props.pointStrokeColor}
                strokeWidth={props.regionStrokeWidth}
                cursor="pointer"
                data-region={point.region}
                className={"transition duration-500"}
              ></circle>
            ))}
          </svg>
          <section
            ref={callRef}
            className={
              "text-gray-100 flex flex-col gap-8 sm:translate-x-12 translate-x-4 opacity-0"
            }
          >
            <p className={"lg:text-3xl text-xl"}></p>
            <div className={"bg-gray-100 rounded p-4 space-y-3 lg:w-full"}>
              <p className={"text-dark-blue sm:text-lg font-semibold"}>
                Masz problem z dostępem do czystej wody pitnej?
              </p>
              <p className={"text-dark-blue sm:text-lg "}>
                <span className={"underline"}>Nie czekaj dłużej!</span>{" "}
                Skorzystaj z naszych profesjonalnych usług wiercenia studni
                głębinowej i ciesz się świeżą wodą prosto spod ziemi.
              </p>
              <Link
                href={`tel:+48${contact.telephone}`}
                className={
                  "text-dark-blue p-2 rounded bg-light-orange text-2xl sm:w-1/2 w-full mx-auto hover:bg-dark-orange transition"
                }
              >
                Zadzwoń!
              </Link>
            </div>
          </section>
        </div>
      </Article>
    </Container>
  );
});